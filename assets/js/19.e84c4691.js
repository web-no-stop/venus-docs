(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{425:function(e,s,t){"use strict";t.r(s);var a=t(17),o=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),t("p",[t("code",[e._v("lotus-miner")]),e._v(" can be seamlessly connected to the "),t("code",[e._v("venus")]),e._v(" shared components through customizations. If you haven't added any custom code to "),t("code",[e._v("lotus-miner")]),e._v(", you can use the venus-ready branch directly. If you have customized code for "),t("code",[e._v("lotus-miner")]),e._v(", you can refer to the latest "),t("code",[e._v("commit")]),e._v(" in the venus-ready branch to make "),t("code",[e._v("lotus-miner")]),e._v(" compatible with "),t("code",[e._v("venus")]),e._v(" shared modules.")]),e._v(" "),t("p",[e._v("Main changes:")]),e._v(" "),t("ol",[t("li",[e._v("Send messages to shared modules")]),e._v(" "),t("li",[e._v("Calculate WinningPost")]),e._v(" "),t("li",[e._v("Disable block mining of lotus-miner")])]),e._v(" "),t("h3",{attrs:{id:"branches"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#branches"}},[e._v("#")]),e._v(" Branches")]),e._v(" "),t("p",[e._v("List of lotus version(s) to their corresponding venus-ready branch.")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("lotus ver.")]),e._v(" "),t("th",[e._v("venus-ready branch")]),e._v(" "),t("th",[e._v("venus-ready commit")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("1.10.1")]),e._v(" "),t("td",[t("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commits/force/v1.10.1_venus_pool",target:"_blank",rel:"noopener noreferrer"}},[e._v("v1.10.1_venus_pool"),t("OutboundLink")],1)]),e._v(" "),t("td",[t("a",{attrs:{href:"https://github.com/ipfs-force-community/lotus/commit/212721a6b4677f2ffe36688a50f1cacde7ae5e54",target:"_blank",rel:"noopener noreferrer"}},[e._v("212721a6b4677f2ffe36688a50f1cacde7ae5e54"),t("OutboundLink")],1)])])])]),e._v(" "),t("h2",{attrs:{id:"code-walk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#code-walk"}},[e._v("#")]),e._v(" Code walk")]),e._v(" "),t("p",[e._v("The following outlines some of the key changes to the code.")]),e._v(" "),t("h3",{attrs:{id:"configuration-change"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration-change"}},[e._v("#")]),e._v(" Configuration Change")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('[Venus]\n  [Venus.Messager]\n    Url = ""\n    Token = ""\n  [Venus.RegisterProofAPI]\n    Url = ""\n    Token = ""\n  [Venus.Wallet]\n    Url = ""\n    Token = ""\n')])])]),t("h3",{attrs:{id:"message-apis-for-lotus-miner"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#message-apis-for-lotus-miner"}},[e._v("#")]),e._v(" Message APIs for lotus-miner")]),e._v(" "),t("p",[e._v("Among the commands provided by lotus-miner, the commands that need to send, wait, and search for messages are all realized by calling the newly added messenger interface of lotus-miner.")]),e._v(" "),t("ol",[t("li",[e._v("MessagerWaitMessage")]),e._v(" "),t("li",[e._v("MessagerPushMessage")]),e._v(" "),t("li",[e._v("MessagerGetMessage")])]),e._v(" "),t("p",[e._v("File path(s)：")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("cmd/lotus-storage-miner/*\napi/api_storage.go\nextern/storage-sealing/sealing.go\nextern/storage-sealing/terminate_batch.go\nnode/modules/storageminer.go\nstorage/*\n")])])]),t("h3",{attrs:{id:"add-gasoverestimate-params-to-messagesendspec"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-gasoverestimate-params-to-messagesendspec"}},[e._v("#")]),e._v(" Add GasOverEstimate params to MessageSendSpec")]),e._v(" "),t("p",[e._v("File path(s)：api/types.go")]),e._v(" "),t("div",{staticClass:"language-go extra-class"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" MessageSendSpec "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tMaxFee            abi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("TokenAmount\n\tGasOverEstimation "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("float64")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("h3",{attrs:{id:"check-if-address-exists-before-sending-messages"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#check-if-address-exists-before-sending-messages"}},[e._v("#")]),e._v(" Check if address exists before sending messages")]),e._v(" "),t("p",[e._v("In lotus-miner, the API that was used to determine the existence of the address needs to be changed to the WalletHas API that calls the messenger.")]),e._v(" "),t("p",[e._v("File path(s): "),t("code",[e._v("storage/addresses.go")])]),e._v(" "),t("h3",{attrs:{id:"venus-messager-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#venus-messager-client"}},[e._v("#")]),e._v(" venus-messager client")]),e._v(" "),t("p",[e._v("The venus-messager client is similar to lotus, both of which use jsonrpc. You can use lotus' jsonrpc library for access. Note that the namespace is Message.")]),e._v(" "),t("p",[e._v("File path(s):  "),t("code",[e._v("node/modules/messager/*")])]),e._v(" "),t("h3",{attrs:{id:"listen-to-gateway-for-computeproof-requests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#listen-to-gateway-for-computeproof-requests"}},[e._v("#")]),e._v(" Listen to gateway for ComputeProof requests")]),e._v(" "),t("p",[e._v("This component is used to listen to the requests issued by the shared modules, and it is used to calculate the WinningPost in the miner.")]),e._v(" "),t("p",[e._v("File path(s): "),t("code",[e._v("cli/wallet_client.go")]),e._v(", "),t("code",[e._v("node/impl/proof_client/*")])]),e._v(" "),t("h3",{attrs:{id:"non-message-type-signing-to-local-wallet-storageask-dealproposal"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#non-message-type-signing-to-local-wallet-storageask-dealproposal"}},[e._v("#")]),e._v(" Non-message type signing to local wallet（StorageAsk， DealProposal）")]),e._v(" "),t("p",[e._v("Since the private key no longer exists in the remote node, some message signing that do not require the participation of shared modules (such as StorageAsk, DealProposal) need to be connected to the wallet and sign locally")]),e._v(" "),t("p",[e._v("File path(s): "),t("code",[e._v("markets/storageadapter/provider.go")])]),e._v(" "),t("h3",{attrs:{id:"lotus-miner-disable-mining-blocks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lotus-miner-disable-mining-blocks"}},[e._v("#")]),e._v(" lotus-miner disable mining blocks")]),e._v(" "),t("p",[e._v("As shared modules are responsible for mining blocks, local block mining must be diabled to prevent  consensus errors. Therefore, you must disable local block mining.")]),e._v(" "),t("p",[e._v("File path(s): "),t("code",[e._v("node/modules/storageminer.go")]),e._v(" func "),t("code",[e._v("SetupBlockProducer")])])])}),[],!1,null,null,null);s.default=o.exports}}]);