(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{452:function(e,t,s){"use strict";s.r(t);var a=s(17),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"frontmatter-title"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[e._v("#")]),e._v(" "+e._s(e.$frontmatter.title))]),e._v(" "),s("p",[e._v(e._s(e.$frontmatter.description)+" Messages are added to the mpool either directly for locally published messages or through pubsub propagation. Whenever a miner is ready to create a block for a tipset, it invokes the mpool selection algorithm which selects an appropriate set of messages such that it optimizes miner reward and chain capacity.")]),e._v(" "),s("p",[e._v("When messages are executed, they use "),s("em",[e._v("gas")]),e._v(". The amount of "),s("em",[e._v("gas")]),e._v(" used, the parameters attached to each message and the Network's current "),s("em",[e._v("BaseFee")]),e._v(" determine the final FIL-cost to include the transaction in the chain. Part of that cost is burned by the network. The other part is given to the miner of the first block that includes the transaction as a reward.")]),e._v(" "),s("p",[e._v("The different caps and fees for messages are explained below, along with instructions on how to inspect and interact with the message pool.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Venus provides the tooling to interact with the message pool with the "),s("code",[e._v("venus mpool")]),e._v(" subcommands.")])]),e._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#message-selection"}},[e._v("Message selection")])]),s("li",[s("a",{attrs:{href:"#gas-fees-limits-and-caps"}},[e._v("Gas, fees, limits and caps")])]),s("li",[s("a",{attrs:{href:"#checking-for-pending-messages"}},[e._v("Checking for pending messages")])]),s("li",[s("a",{attrs:{href:"#replacing-messages-in-the-pool"}},[e._v("Replacing messages in the pool")])])])]),s("p"),e._v(" "),s("h2",{attrs:{id:"message-selection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#message-selection"}},[e._v("#")]),e._v(" Message selection")]),e._v(" "),s("p",[e._v("When mining a new block, miners must select a set of messages for inclusion in a way that maximizes the reward. Given how message distribution works, using pubsub, and that miners do not communicate their tickets to each other, it is not possible to fully determine if a different miner will also include the message on a different block in the new tipset, and perhaps get the reward instead if their block executes first. The problem is NP-hard (an instance of knapsack packing) so, at best, an approximation can be made to the optimal selection in a reasonable amount of time.")]),e._v(" "),s("p",[e._v("Venus employs a sophisticated algorithm for selecting messages for inclusion from the pool, given the ticket quality of a miner. The ticket quality reflects the probability of execution order for a block in the tipset. Given the ticket quality the algorithm computes the probability of each block, and picks dependent chains of messages such that the reward is maximized, while also optimizing the capacity of the chain.")]),e._v(" "),s("p",[e._v("If the ticket quality is sufficiently high, then a greedy selection algorithm is used instead that simply picks dependent chains of maximum reward. Note that pending message chains from priority addresses are always selected, regardless of their profitability.")]),e._v(" "),s("h2",{attrs:{id:"gas-fees-limits-and-caps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gas-fees-limits-and-caps"}},[e._v("#")]),e._v(" Gas, fees, limits and caps")]),e._v(" "),s("p",[e._v("When a message is executed it consumes "),s("em",[e._v("gas")]),e._v(". The total gas consumed by a message directly affects the cost to place that message in the blockchain, which is a price that the sender will have to pay.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Venus can be configured with several addresses to have more granular control over fees and limits depending on the operation and avoid head-of-line blocking, particularly for high value operations such as "),s("em",[e._v("WindowPoSts")]),e._v(". Check the "),s("RouterLink",{attrs:{to:"/mine/venus/miner-addresses.html"}},[e._v("miner addresses guide")]),e._v(".")],1)]),e._v(" "),s("p",[e._v("As an additional tip, you can use Lotus to find out about the current "),s("em",[e._v("BaseFee")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Will print the last BaseFee in attoFIL")]),e._v("\nvenus chain "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("head")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("xargs")]),e._v(" venus chain getblock "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" jq -r .ParentBaseFee\n")])])]),s("h2",{attrs:{id:"checking-for-pending-messages"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#checking-for-pending-messages"}},[e._v("#")]),e._v(" Checking for pending messages")]),e._v(" "),s("p",[e._v("If messages are not deemed attractive enough by miners to be included in new blocks, they may become stuck in the message pool. This is usually a consequence of the "),s("em",[e._v("GasFeeCap")]),e._v(" being too low, for example, when the Network's "),s("em",[e._v("BaseFee")]),e._v(" is high. It can also be a consequence of the "),s("em",[e._v("GasPremium")]),e._v(" being too low if the network is congested.")]),e._v(" "),s("p",[e._v("You can check for messages currently in the pool and specifically sent by your node with:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("venus mpool pending --local\n")])])]),s("p",[e._v("For each message you will be able to see key information like the "),s("em",[e._v("GasLimit")]),e._v(", the "),s("em",[e._v("GasFeeCap")]),e._v(" and the "),s("em",[e._v("GasPremium")]),e._v(" values, explained above.")]),e._v(" "),s("p",[e._v("To reduce the output to the messages key values you can use:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("venus mpool pending --local "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Nonce"')]),e._v(" -A5\n")])])]),s("p",[e._v("In order to avoid messages from staying long periods in the pool when they are sent, it is possible to adjust the "),s("RouterLink",{attrs:{to:"/mine/venus/sealer-configuration.html"}},[e._v("Venus Miner fees in the configuration")]),e._v(" and use "),s("RouterLink",{attrs:{to:"/mine/venus/miner-addresses.html"}},[e._v("additional control addresses for "),s("em",[e._v("WindowPoSts")])]),e._v(". Existing messages can be replaced at any time with the procedure explained below.")],1),e._v(" "),s("h2",{attrs:{id:"replacing-messages-in-the-pool"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#replacing-messages-in-the-pool"}},[e._v("#")]),e._v(" Replacing messages in the pool")]),e._v(" "),s("p",[e._v("You can replace messages in the pool by pushing a new message with the same "),s("code",[e._v("Nonce")]),e._v(" that has a "),s("strong",[e._v("new "),s("code",[e._v("GasPremium")]),e._v(" that is at least 25% larger than that of the original message")]),e._v(". To this effect, the easiest is to use:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("venus mpool replace --auto "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("from"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("nonce"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("p",[e._v("The above command will replace the associated message in the pool and automatically reprice it with a new "),s("em",[e._v("GasPremium")]),e._v(" and "),s("em",[e._v("GasFeeCap")]),e._v(" as estimated from the current network conditions. You can also set "),s("code",[e._v("--max-fee")]),e._v(" if you wish to limit the total amount to spend for the message. All other flags are ignored.")]),e._v(" "),s("p",[e._v("Alternatively, the "),s("em",[e._v("GasPremium")]),e._v(", "),s("em",[e._v("GasFeeCap")]),e._v(" can be set manually with their respective flags:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("venus mpool replace --gas-feecap "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("feecap"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" --gas-premium "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("premium"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("from"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("nonce"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("p",[e._v("If the new "),s("em",[e._v("gas premium")]),e._v(" is lower than the 1.25 ratio to the original, the message will not be included in the pool. Additional message fields, like the recipient of the transaction, can be changed when using the "),s("code",[e._v("MpoolPush")]),e._v(" API method directly. In this case the new message will need to be locally signed first.")]),e._v(" "),s("p",[e._v("The "),s("em",[e._v("GasLimit")]),e._v(" should not be changed under normal circumstances. For instructions on how to use the optional flag to replace the "),s("em",[e._v("GasLimit")]),e._v(" please consult")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("venus mpool replace --help\n")])])])])}),[],!1,null,null,null);t.default=o.exports}}]);